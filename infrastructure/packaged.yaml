AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Globals:
  Api:
    Cors:
      AllowMethods: '''OPTIONS,POST,GET,PATCH'''
      AllowHeaders: '''Authorization,Content-Type'''
      AllowOrigin: '''*'''
Resources:
  BUDDomainName:
    Type: AWS::ApiGateway::DomainName
    Properties:
      CertificateArn: arn:aws:acm:us-east-1:349390452115:certificate/a42914a1-583d-479a-b3a5-1ebd2651491d
      DomainName: api.betweenusdrivers.jacobclark.dev
  BUDHostedZone:
    Type: AWS::Route53::HostedZone
    Properties:
      Name: api.betweenusdrivers.jacobclark.dev
  APIBasePathMapping:
    Type: AWS::ApiGateway::BasePathMapping
    Properties:
      DomainName:
        Ref: BUDDomainName
      RestApiId:
        Ref: BUDAPI
      Stage: production
  APIDomain:
    Type: AWS::Route53::RecordSetGroup
    Properties:
      HostedZoneId:
        Ref: BUDHostedZone
      RecordSets:
      - Name: api.betweenusdrivers.jacobclark.dev
        Type: A
        AliasTarget:
          DNSName:
            Fn::GetAtt:
            - BUDDomainName
            - DistributionDomainName
          HostedZoneId: Z2FDTNDATAQYW2
      - Name: _9492ef477a77eb88288d14ff52b92377.api.betweenusdrivers.jacobclark.dev.
        Type: CNAME
        TTL: '900'
        SetIdentifier: DNS Verification
        Weight: '6'
        ResourceRecords:
        - _08364b503ac9876f834dcccc940494b1.olprtlswtu.acm-validations.aws.
  BUDAPI:
    Type: AWS::Serverless::Api
    Properties:
      StageName: production
      CacheClusterEnabled: true
      CacheClusterSize: '0.5'
      MethodSettings:
      - ResourcePath: /v1/polls
        CachingEnabled: true
        CacheTtlInSeconds: 600
        HttpMethod: GET
      - ResourcePath: /v1/polls
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/polls/{pollId}
        CachingEnabled: true
        CacheTtlInSeconds: 600
        HttpMethod: GET
      - ResourcePath: /v1/polls/{pollId}/votes
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/polls/{pollId}/votes
        CachingEnabled: false
        HttpMethod: GET
      - ResourcePath: /v1/users
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/users/{userId}
        CachingEnabled: true
        CacheTtlInSeconds: 600
        HttpMethod: GET
      - ResourcePath: /v1/users/{userId}/votes
        CachingEnabled: false
        HttpMethod: GET
      - ResourcePath: /v1/users/{userId}
        CachingEnabled: false
        HttpMethod: PATCH
      - ResourcePath: /v1/authorizeUser
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/forgotPassword
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/resetPassword
        CachingEnabled: false
        HttpMethod: POST
      - ResourcePath: /v1/verify/{token}
        CachingEnabled: false
        HttpMethod: GET
      DefinitionBody:
        swagger: '2.0'
        info:
          version: '1'
          title: between-us-drivers
        basePath: /v1
        schemes:
        - https
        paths:
          /v1/polls:
            get:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDGetPollsHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
            post:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDCreatePollHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/polls/{pollId}:
            get:
              responses: {}
              produces:
              - application/json
              parameters:
              - name: pollId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDGetPollHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
                cacheNamespace: cs0i4n
                cacheKeyParameters:
                - method.request.path.pollId
          /v1/polls/{pollId}/votes:
            post:
              responses: {}
              security:
              - TokenAuthorizer: []
              produces:
              - application/json
              parameters:
              - name: pollId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDPollVoteHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
            get:
              responses: {}
              parameters:
              - name: pollId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDGetPollVotesHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/users:
            post:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDCreateUserHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/users/{userId}:
            patch:
              responses: {}
              security:
              - TokenAuthorizer: []
              parameters:
              - name: userId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDUpdateUserHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
            get:
              responses: {}
              parameters:
              - name: userId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDGetUserHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
                cacheNamespace: cs0i4n
                cacheKeyParameters:
                - method.request.path.userId
          /v1/users/{userId}/votes:
            get:
              responses: {}
              parameters:
              - name: userId
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDGetUsersVotesHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/verify/{token}:
            get:
              responses: {}
              parameters:
              - name: token
                in: path
                required: true
                type: string
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDVerifyUserHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/authorizeUser:
            post:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDAuthorizeUserHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/forgotPassword:
            post:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDForgotPasswordHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
          /v1/resetPassword:
            post:
              responses: {}
              x-amazon-apigateway-integration:
                uri:
                  Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDResetPasswordHandler/invocations
                passthroughBehavior: when_no_match
                httpMethod: POST
                type: aws_proxy
        securityDefinitions:
          TokenAuthorizer:
            type: apiKey
            name: Authorization
            in: header
            x-amazon-apigateway-authtype: custom
            x-amazon-apigateway-authorizer:
              authorizerUri:
                Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:BUDAuthorizerHandler/invocations
              authorizerResultTtlInSeconds: 0
              identityValidationExpression: ^[Bb]earer [-0-9a-zA-z\.]*$
              type: token
  BUDGetPollHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDGetPollHandler
      Handler: src/handlers/polls/getPoll.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/polls/{pollId}
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDPollTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDCreatePollHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDCreatePollHandler
      Handler: src/handlers/polls/createPoll.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/polls
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDPollTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDGetPollsHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDGetPollsHandler
      Handler: src/handlers/polls/getPolls.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/polls
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:Scan
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDPollTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDPollVoteHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDPollVoteHandler
      Handler: src/handlers/polls/votePoll.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/polls/{pollId}/votes
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDVoteTable
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserVoteTable
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDGetPollVotesHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDGetPollVotesHandler
      Handler: src/handlers/polls/getPollVotes.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/polls/{pollId}/votes
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDVoteTable
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDVoteTable/index/VoteFromPollIdIndex
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDGetUserHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDGetUserHandler
      Handler: src/handlers/users/getUser.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/users/{userId}
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDGetUsersVotesHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDGetUsersVotesHandler
      Handler: src/handlers/users/getUsersVotes.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/users/{userId}/votes
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:GetItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserVoteTable
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserVoteTable/index/UsersVotesFromUserIdIndex
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDCreateUserHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDCreateUserHandler
      Handler: src/handlers/users/createUser.handler
      Runtime: nodejs8.10
      Timeout: 10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/users
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:PutItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/PasswordFromEmailIndex
        - Effect: Allow
          Action:
          - ses:SendEmail
          - ses:SendRawEmail
          Resource: '*'
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDUpdateUserHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDUpdateUserHandler
      Handler: src/handlers/users/updateUser.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/users/{userId}
            Method: Patch
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/PasswordFromEmailIndex
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDAuthorizeUserHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDAuthorizeUserHandler
      Handler: src/handlers/users/authorizeUser.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/authorizeUser
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/PasswordFromEmailIndex
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDForgotPasswordHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDForgotPasswordHandler
      Handler: src/handlers/users/forgotPassword.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/forgotPassword
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/PasswordFromEmailIndex
        - Effect: Allow
          Action:
          - ses:SendEmail
          - ses:SendRawEmail
          Resource: '*'
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDResetPasswordHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDResetPasswordHandler
      Handler: src/handlers/users/resetPassword.handler
      Runtime: nodejs8.10
      Timeout: 10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/resetPassword
            Method: Post
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/UserFromPasswordResetTokenIndex
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDVerifyUserHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDVerifyUserHandler
      Handler: src/handlers/users/verifyUser.handler
      Runtime: nodejs8.10
      Events:
        Api:
          Type: Api
          Properties:
            Path: /v1/verify/{token}
            Method: Get
            RestApiId:
              Ref: BUDAPI
      Policies:
      - Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
        - Effect: Allow
          Action:
          - dynamodb:Query
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable/index/UserFromVerificationTokenIndex
        - Effect: Allow
          Action:
          - dynamodb:UpdateItem
          Resource:
            Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/BUDUserTable
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  BUDAuthorizerHandler:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: BUDAuthorizerHandler
      Handler: src/handlers/authorizer/authorize.handler
      Runtime: nodejs8.10
      CodeUri: s3://between-us-drivers-infrastructure/2fb07671a3135bf2bbcf614206332596
  ConfigLambdaPermission:
    Type: AWS::Lambda::Permission
    DependsOn:
    - BUDAPI
    - BUDAuthorizerHandler
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Ref: BUDAuthorizerHandler
      Principal: apigateway.amazonaws.com
  BUDPollTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDPollTable
      AttributeDefinitions:
      - AttributeName: pollId
        AttributeType: S
      KeySchema:
      - AttributeName: pollId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
  BUDUserTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDUserTable
      AttributeDefinitions:
      - AttributeName: userId
        AttributeType: S
      - AttributeName: email
        AttributeType: S
      - AttributeName: verificationToken
        AttributeType: S
      - AttributeName: passwordResetToken
        AttributeType: S
      KeySchema:
      - AttributeName: userId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: PasswordFromEmailIndex
        KeySchema:
        - AttributeName: email
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      - IndexName: UserFromVerificationTokenIndex
        KeySchema:
        - AttributeName: verificationToken
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      - IndexName: UserFromPasswordResetTokenIndex
        KeySchema:
        - AttributeName: passwordResetToken
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
  BUDVoteTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDVoteTable
      AttributeDefinitions:
      - AttributeName: voteId
        AttributeType: S
      - AttributeName: pollId
        AttributeType: S
      KeySchema:
      - AttributeName: voteId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: VoteFromPollIdIndex
        KeySchema:
        - AttributeName: pollId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
  BUDUserVoteTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDUserVoteTable
      AttributeDefinitions:
      - AttributeName: userVoteId
        AttributeType: S
      - AttributeName: userId
        AttributeType: S
      KeySchema:
      - AttributeName: userVoteId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: UsersVotesFromUserIdIndex
        KeySchema:
        - AttributeName: userId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
  BUDCommentTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDCommentTable
      AttributeDefinitions:
      - AttributeName: commentId
        AttributeType: S
      KeySchema:
      - AttributeName: commentId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
  BUDCommentVoteTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: BUDCommentVoteTable
      AttributeDefinitions:
      - AttributeName: commentVoteId
        AttributeType: S
      KeySchema:
      - AttributeName: commentVoteId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
